<launch>
  <!-- Simulador básico con lidar -->
  <include file="$(find-pkg-share very_simple_robot_simulator)/launch/minimal_simulator_py.xml" />
  <include file="$(find-pkg-share very_simple_robot_simulator)/launch/lidar_simulator.xml" />
  <include file="$(find-pkg-share very_simple_robot_simulator)/launch/world_state.xml" />

  <!-- Robot simulator con posición inicial -->
  <node pkg="very_simple_robot_simulator" exec="kobuki_simulator.py" name="kobuki_simulator" output="screen">
    <param name="initial_x" value="1.0"/>
    <param name="initial_y" value="1.0"/>
    <param name="initial_yaw" value="0.0"/>
  </node>

  <!-- GUI del mundo con mapa -->
  <node pkg="very_simple_robot_simulator" exec="world_state_gui.py" name="world_state_gui" output="screen">
    <param name="map_file" value="$(find-pkg-share iic2685_lab3)/maps/mapa.yaml"/>
  </node>

  <!-- Lidar simulator -->
  <node pkg="very_simple_robot_simulator" exec="lidar_simulator" name="lidar_simulator" output="screen">
    <param name="effective_hfov" value="181.0"/>
    <param name="view_depth" value="4.0"/>
  </node>

  <!-- Transforms entre frames de referencia -->
  <node pkg="tf2_ros" exec="static_transform_publisher" name="world_map_to_odom" 
        args="--x 0.0 --y 0.0 --z 0.0 --roll 0.0 --pitch 0.0 --yaw 0.0 --frame-id map --child-frame-id odom"/>
  
  <node pkg="tf2_ros" exec="static_transform_publisher" name="odom_to_base_link" 
        args="--x 0.0 --y 0.0 --z 0.0 --roll 0.0 --pitch 0.0 --yaw 0.0 --frame-id odom --child-frame-id base_link"/>

  <!-- Nodo del modelo de sensor (Actividad 1) -->
  <node pkg="iic2685_lab3" exec="sensor_model.py" name="sensor_model" output="screen">
    <param name="sigma" value="0.1" />
    <param name="z_max" value="4.0" />
  </node>
  
  <!-- Nodo del filtro de partículas (Actividad 2) -->
  <node pkg="iic2685_lab3" exec="particle_filter.py" name="particle_filter" output="screen">
    <param name="num_particles" value="1000" />
    <param name="alpha1" value="0.2" />
    <param name="alpha2" value="0.2" />
    <param name="alpha3" value="0.2" />
    <param name="alpha4" value="0.2" />
    <param name="convergence_threshold" value="0.5" />
  </node>
  
  <!-- Nodo de navegación exploratoria -->
  <node pkg="iic2685_lab3" exec="exploration_navigator.py" name="exploration_navigator" output="screen">
    <param name="wall_distance" value="0.5" />
    <param name="linear_speed" value="0.2" />
    <param name="angular_speed" value="0.5" />
  </node>
  
  <!-- Nodo coordinador principal -->
  <node pkg="iic2685_lab3" exec="localization_manager.py" name="localization_manager" output="screen">
    <param name="move_distance" value="0.3" />
    <param name="move_angle" value="0.3" />
    <param name="iterations_per_move" value="5" />
  </node>

  <!-- RViz para visualización -->
  <node pkg="rviz2" exec="rviz2" name="rviz2" output="screen"/>

</launch>