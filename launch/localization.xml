<launch>
    <!-- Robot Simulation -->
    <node pkg="very_simple_robot_simulator" exec="kobuki_simulator.py" name="kobuki_simulator">
      <param name="initial_x" value="0.5"/>
      <param name="initial_y" value="0.5"/>
      <param name="initial_yaw" value="0.0"/>
    </node>

    <!-- Enviroment Simulation -->
    <node pkg="very_simple_robot_simulator" exec="world_state_gui.py" name="world_state_gui" output="screen">
      <param name="map_file" value="$(find-pkg-share ayudantia_rviz)/map/mapa.yaml"/>
    </node>

    <!-- Lidar Simulation -->
    <node pkg="very_simple_robot_simulator" exec="lidar_simulator" name="lidar_simulator">
      <param name="effective_hfov" value="181.0"/>
      <param name="view_depth" value="20.0"/>
    </node>

    <!-- Transforms between reference frames -->
    <node pkg="tf2_ros" exec="static_transform_publisher" name="world_map_to_odom" args="--x 0.5 --y 0.5 --z 0.0 --roll 0.0 --pitch 0.0 --yaw 0.0 --frame-id world_map --child-frame-id odom"/>

    <!-- RViz2 -->
    <node pkg="rviz2" exec="rviz2" name="rviz2" output="screen"/>

    <!-- Recieves input from keyboard -->

    <node pkg="teleop_twist_keyboard" exec="teleop_twist_keyboard" name="teleop_twist_keyboard" output="screen"/> 

    <!-- Lanzar el modelo de sensor -->
    <node pkg="iic2685_lab3" exec="sensor_model" name="sensor_model" output="screen">
        <param name="sigma" value="0.1"/>
        <param name="z_max" value="4.0"/>
        <param name="map_file" value="mapa.yaml"/>
    </node>
    
    <!-- Lanzar el filtro de partículas -->
    <node pkg="iic2685_lab3" exec="particle_filter" name="particle_filter" output="screen">
        <param name="num_particles" value="500"/>
        <param name="motion_noise_x" value="0.05"/>
        <param name="motion_noise_y" value="0.05"/>
        <param name="motion_noise_theta" value="0.1"/>
        <param name="convergence_threshold" value="0.5"/>
        <param name="convergence_percentage" value="0.8"/>
        <param name="wall_follow_distance" value="0.5"/>
        <param name="forward_speed" value="0.2"/>
        <param name="turn_speed" value="0.5"/>
    </node>
    
    <!-- Lanzar RViz para visualización -->
    <node pkg="rviz2" exec="rviz2" name="rviz2" output="screen" args="-d $(find-pkg-share iic2685_lab3)/rviz/localization.rviz"/>



    <!-- Recieves input from joystick -->

    <node pkg="joy" exec="joy_node" name="joy_node"/> 

    <!-- Converts joystick input to Twist messages -->

    <node pkg="teleop_twist_joy" exec="teleop_node" name="teleop_node">
            <param name="axis_linear.x" value="1"/>
            <param name="axis_angular.yaw" value="2"/>
        </node> 

</launch>